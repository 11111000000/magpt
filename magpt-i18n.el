;;; magpt-i18n.el --- i18n tables and helpers for MaGPT -*- lexical-binding: t; -*-

;; Centralizes localized UI messages for magpt.

;;; Code:

(require 'subr-x)

;; Forward decls from core
(declare-function magpt--maybe-load-rc "ext:magpt")
(declare-function magpt--log "ext:magpt" (fmt &rest args))

(defvar magpt-info-language "English"
  "Preferred natural language for informative content (summaries, rationales) in assist tasks.")

(defun magpt--lang-code ()
  "Return language code symbol based on `magpt-info-language'."
  (let* ((raw (or magpt-info-language "English"))
         (l (downcase raw)))
    (cond
     ;; Russian
     ((string-match-p "\\`\\(ru\\|рус\\)" l) 'ru)
     ;; Ukrainian (uk / укр / україн)
     ((or (string-match-p "\\`uk" l)
          (string-match-p "укр" l)
          (string-match-p "україн" l)) 'uk)
     ;; Belarusian (be / бел / беларус)
     ((or (string-match-p "\\`be" l)
          (string-match-p "бел" l)
          (string-match-p "беларус" l)) 'be)
     ;; Chinese (zh / 中文 / кит)
     ((or (string-match-p "\\`zh" l)
          (string-match-p "中文" raw)
          (string-match-p "кит" l)) 'zh)
     ;; French kept for backward-compatibility if user sets it
     ((string-match-p "\\`fr" l) 'fr)
     ;; Default English
     (t 'en))))

;; English
(defconst magpt--i18n-en
  '((confirm-send-full . "magpt: Send staged diff to LLM (%d bytes)? ")
    (confirm-send-trunc . "magpt: Send staged diff to LLM (original %d bytes; sending %d bytes after truncation)? ")
    (request-llm-commit . "magpt: requesting LLM to generate commit message...")
    (result-copied . "magpt: result copied to kill-ring and shown in *magpt-commit*")
    (empty-response . "magpt: empty response from model")
    (insertion-cancelled . "magpt: insertion cancelled by user")
    (inserted-into-commit-buffer . "magpt: commit message inserted into commit buffer")
    (inserted-into-buffer-named . "magpt: commit message inserted into %s")
    (gptel-error . "magpt: error calling gptel: %s")
    (gptel-error2 . "magpt/gptel error: %s")
    (sending-cancelled . "magpt: sending cancelled by user")
    (no-staged-changes . "No staged changes found (git add ...)")
    (replace-current-commit-msg? . "Replace the current commit message and insert the generated one? ")
    (callback-error . "magpt: error in callback: %s")
    ;; Overview/History (keys used by AI Overview)
    (overview-response . "Response:")
    (json-opened . "Opened response in JSON buffer")
    (json-copied . "Response copied to kill-ring")
    ;; Section titles (localized UI)
    (overview-summary . "Summary:")
    (overview-risks . "Risks:")
    (overview-suggestions . "Suggestions:")
    (overview-lint-status . "Lint status:")
    (overview-issues . "Issues:")
    (overview-suggestion . "Suggestion:")
    (overview-name . "Name:")
    (overview-alternatives . "Alternatives:")
    (overview-rationale . "Rationale:")
    (overview-steps . "Steps:")
    ;; Card titles (localized UI)
    (overview-card-commit-lint . "Commit Lint / Fix Suggest")
    (overview-card-branch-name . "Branch Name Suggest")
    (overview-card-resolve-conflict . "Resolve Conflict (here)")
    (overview-card-push-pull . "Push/Pull advice")
    (overview-card-branches . "Branches overview")
    (overview-card-restore-file . "Recover file (how-to)")
    (overview-card-reset-files . "Reset files (how-to)")
    (overview-no-data . "(no data - press [. g] to refresh)")
    (overview-stale . "(status changed - press [. g] to refresh)")
    (patch-opened . "Opened response in patch buffer")))

;; Russian
(defconst magpt--i18n-ru
  '((confirm-send-full . "magpt: Отправить staged‑дифф в LLM (%d байт)? ")
    (confirm-send-trunc . "magpt: Отправить staged‑дифф в LLM (исходно %d байт; отправим %d байт после усечения)? ")
    (request-llm-commit . "magpt: запрашиваем LLM для генерации сообщения коммита...")
    (result-copied . "magpt: результат показан в *magpt-commit* и скопирован в kill-ring")
    (empty-response . "magpt: пустой ответ от модели")
    (insertion-cancelled . "magpt: вставка отменена пользователем")
    (inserted-into-commit-buffer . "magpt: сообщение коммита вставлено в буфер коммита")
    (inserted-into-buffer-named . "magpt: сообщение коммита вставлено в %s")
    (gptel-error . "magpt: ошибка вызова gptel: %s")
    (gptel-error2 . "magpt/gptel ошибка: %s")
    (sending-cancelled . "magpt: отправка отменена пользователем")
    (no-staged-changes . "Нет застейдженных изменений (сделайте git add ...)")
    (replace-current-commit-msg? . "Заменить текущее сообщение коммита и вставить сгенерированное? ")
    (callback-error . "magpt: ошибка в callback: %s")
    ;; Обзор/История
    (overview-response . "Ответ:")
    (json-opened . "Ответ открыт в JSON буфере")
    (json-copied . "Ответ скопирован в kill-ring")
    ;; Заголовки секций
    (overview-summary . "Сводка:")
    (overview-risks . "Риски:")
    (overview-suggestions . "Рекомендации:")
    (overview-lint-status . "Статус lint:")
    (overview-issues . "Проблемы:")
    (overview-suggestion . "Предложение:")
    (overview-name . "Имя:")
    (overview-alternatives . "Альтернативы:")
    (overview-rationale . "Обоснование:")
    (overview-steps . "Шаги:")
    ;; Заголовки карточек
    (overview-card-commit-lint . "Линт коммита / правка")
    (overview-card-branch-name . "Имя ветки (рекомендация)")
    (overview-card-resolve-conflict . "Разрешить конфликт (здесь)")
    (overview-card-push-pull . "Push/Pull — советы")
    (overview-card-branches . "Обзор веток")
    (overview-card-restore-file . "Восстановить файл (инструкция)")
    (overview-card-reset-files . "Сброс файлов (инструкция)")
    (overview-no-data . "(нет данных - нажмите [. g] для обновления)")
    (overview-stale . "(статус изменился - нажмите [. g] для обновления)")
    (patch-opened . "Патч открыт в буфере")))

;; French (kept for compatibility)
(defconst magpt--i18n-fr
  '((confirm-send-full . "magpt: Envoyer le diff indexé au LLM (%d octets) ? ")
    (confirm-send-trunc . "magpt: Envoyer le diff indexé au LLM (original %d octets ; envoi de %d octets après troncature) ? ")
    (request-llm-commit . "magpt: demande au LLM de générer le message de commit...")
    (result-copied . "magpt: résultat copié dans le kill-ring et affiché dans *magpt-commit*")
    (empty-response . "magpt: réponse vide du modèle")
    (insertion-cancelled . "magpt: insertion annulée par l'utilisateur")
    (inserted-into-commit-buffer . "magpt: message de commit inséré dans le tampon de commit")
    (inserted-into-buffer-named . "magpt: message de commit inséré dans %s")
    (gptel-error . "magpt: erreur lors de l'appel à gptel : %s")
    (gptel-error2 . "erreur magpt/gptel : %s")
    (sending-cancelled . "magpt: envoi annulé par l'utilisateur")
    (no-staged-changes . "Aucun changement indexé trouvé (git add ...)")
    (replace-current-commit-msg? . "Remplacer le message de commit actuel et insérer celui généré ? ")
    (callback-error . "magpt: erreur dans le callback : %s")
    (overview-response . "Réponse :")
    (json-opened . "Réponse ouverte dans un tampon JSON")
    (json-copied . "Réponse copiée dans le kill-ring")
    (overview-summary . "Résumé :")
    (overview-risks . "Risques :")
    (overview-suggestions . "Suggestions :")
    (overview-lint-status . "Statut du lint :")
    (overview-issues . "Problèmes :")
    (overview-suggestion . "Suggestion :")
    (overview-name . "Nom :")
    (overview-alternatives . "Alternatives :")
    (overview-rationale . "Justification :")
    (overview-steps . "Étapes :")
    (overview-card-commit-lint . "Commit Lint / Correction")
    (overview-card-branch-name . "Suggestion de nom de branche")
    (overview-card-resolve-conflict . "Résoudre le conflit (ici)")
    (overview-card-push-pull . "Conseils Push/Pull")
    (overview-card-branches . "Aperçu des branches")
    (overview-card-restore-file . "Restaurer un fichier (guide)")
    (overview-card-reset-files . "Réinitialiser des fichiers (guide)")
    (overview-no-data . "(aucune donnée — appuyez sur [. g] pour actualiser)")
    (overview-stale . "(état modifié — appuyez sur [. g] pour actualiser)")
    (patch-opened . "Patch ouvert dans un tampon")))

;; Chinese (Simplified)
(defconst magpt--i18n-zh
  '((confirm-send-full . "magpt：将已暂存的差异发送给 LLM（%d 字节）？ ")
    (confirm-send-trunc . "magpt：将已暂存的差异发送给 LLM（原始 %d 字节；截断后发送 %d 字节）？ ")
    (request-llm-commit . "magpt：请求 LLM 生成提交消息...")
    (result-copied . "magpt：结果已显示在 *magpt-commit* 并复制到 kill-ring")
    (empty-response . "magpt：模型返回空响应")
    (insertion-cancelled . "magpt：用户取消了插入")
    (inserted-into-commit-buffer . "magpt：提交消息已插入到提交缓冲区")
    (inserted-into-buffer-named . "magpt：提交消息已插入到 %s")
    (gptel-error . "magpt：调用 gptel 出错：%s")
    (gptel-error2 . "magpt/gptel 错误：%s")
    (sending-cancelled . "magpt：发送已取消")
    (no-staged-changes . "没有已暂存的更改（请先运行 git add ...）")
    (replace-current-commit-msg? . "替换当前提交消息并插入生成的内容？ ")
    (callback-error . "magpt：回调出错：%s")
    (overview-response . "响应：")
    (json-opened . "已在 JSON 缓冲区中打开响应")
    (json-copied . "响应已复制到 kill-ring")
    (overview-summary . "摘要：")
    (overview-risks . "风险：")
    (overview-suggestions . "建议：")
    (overview-lint-status . "Lint 状态：")
    (overview-issues . "问题：")
    (overview-suggestion . "建议：")
    (overview-name . "名称：")
    (overview-alternatives . "备选：")
    (overview-rationale . "理由：")
    (overview-steps . "步骤：")
    (overview-card-commit-lint . "提交 Lint / 修复建议")
    (overview-card-branch-name . "分支名建议")
    (overview-card-resolve-conflict . "解决冲突（此处）")
    (overview-card-push-pull . "Push/Pull 建议")
    (overview-card-branches . "分支概览")
    (overview-card-restore-file . "恢复文件（指南）")
    (overview-card-reset-files . "重置文件（指南）")
    (overview-no-data . "(没有数据 — 按 [. g] 刷新)")
    (overview-stale . "(状态已更改 — 按 [. g] 刷新)")
    (patch-opened . "已在补丁缓冲区中打开响应")))

;; Ukrainian
(defconst magpt--i18n-uk
  '((confirm-send-full . "magpt: Надіслати проіндексований diff до LLM (%d байт)? ")
    (confirm-send-trunc . "magpt: Надіслати проіндексований diff до LLM (спочатку %d байт; надішлемо %d байт після усікання)? ")
    (request-llm-commit . "magpt: запит до LLM для генерації повідомлення коміту...")
    (result-copied . "magpt: результат показано в *magpt-commit* і скопійовано в kill-ring")
    (empty-response . "magpt: порожня відповідь від моделі")
    (insertion-cancelled . "magpt: вставку скасовано користувачем")
    (inserted-into-commit-buffer . "magpt: повідомлення коміту вставлено до буфера коміту")
    (inserted-into-buffer-named . "magpt: повідомлення коміту вставлено до %s")
    (gptel-error . "magpt: помилка виклику gptel: %s")
    (gptel-error2 . "помилка magpt/gptel: %s")
    (sending-cancelled . "magpt: надсилання скасовано користувачем")
    (no-staged-changes . "Немає проіндексованих змін (зробіть git add ...)")
    (replace-current-commit-msg? . "Замінити поточне повідомлення коміту та вставити згенероване? ")
    (callback-error . "magpt: помилка у callback: %s")
    (overview-response . "Відповідь:")
    (json-opened . "Відповідь відкрито в JSON‑буфері")
    (json-copied . "Відповідь скопійовано в kill-ring")
    (overview-summary . "Стисло:")
    (overview-risks . "Ризики:")
    (overview-suggestions . "Рекомендації:")
    (overview-lint-status . "Статус lint:")
    (overview-issues . "Проблеми:")
    (overview-suggestion . "Пропозиція:")
    (overview-name . "Назва:")
    (overview-alternatives . "Альтернативи:")
    (overview-rationale . "Обґрунтування:")
    (overview-steps . "Кроки:")
    (overview-card-commit-lint . "Lint коміту / виправлення")
    (overview-card-branch-name . "Назва гілки (рекомендація)")
    (overview-card-resolve-conflict . "Розв’язати конфлікт (тут)")
    (overview-card-push-pull . "Поради Push/Pull")
    (overview-card-branches . "Огляд гілок")
    (overview-card-restore-file . "Відновити файл (інструкція)")
    (overview-card-reset-files . "Скинути файли (інструкція)")
    (overview-no-data . "(немає даних — натисніть [. g] для оновлення)")
    (overview-stale . "(стан змінився — натисніть [. g] для оновлення)")
    (patch-opened . "Відповідь відкрито в буфері патчу")))

;; Belarusian
(defconst magpt--i18n-be
  '((confirm-send-full . "magpt: Адправіць праіндэксаваны diff у LLM (%d байт)? ")
    (confirm-send-trunc . "magpt: Адправіць праіндэксаваны diff у LLM (першапачаткова %d байт; адправім %d байт пасля абразання)? ")
    (request-llm-commit . "magpt: запытваем у LLM згенераваць паведамленне каміту...")
    (result-copied . "magpt: вынік паказаны ў *magpt-commit* і скапіяваны ў kill-ring")
    (empty-response . "magpt: пусты адказ ад мадэлі")
    (insertion-cancelled . "magpt: устаўка адменена карыстальнікам")
    (inserted-into-commit-buffer . "magpt: паведамленне каміту ўстаўлена ў буфер каміту")
    (inserted-into-buffer-named . "magpt: паведамленне каміту ўстаўлена ў %s")
    (gptel-error . "magpt: памылка выкліку gptel: %s")
    (gptel-error2 . "памылка magpt/gptel: %s")
    (sending-cancelled . "magpt: адпраўка адменена карыстальнікам")
    (no-staged-changes . "Няма праіндэксаваных змен (зрабіце git add ...)")
    (replace-current-commit-msg? . "Замяніць бягучае паведамленне каміту і ўставіць згенераванае? ")
    (callback-error . "magpt: памылка ў callback: %s")
    (overview-response . "Адказ:")
    (json-opened . "Адказ адкрыты ў JSON‑буферы")
    (json-copied . "Адказ скапіяваны ў kill-ring")
    (overview-summary . "Зводка:")
    (overview-risks . "Рызыкі:")
    (overview-suggestions . "Рэкамендацыі:")
    (overview-lint-status . "Статус lint:")
    (overview-issues . "Праблемы:")
    (overview-suggestion . "Прапановa:")
    (overview-name . "Імя:")
    (overview-alternatives . "Альтэрнатывы:")
    (overview-rationale . "Абгрунтаванне:")
    (overview-steps . "Крокі:")
    (overview-card-commit-lint . "Lint каміту / выпраўленне")
    (overview-card-branch-name . "Імя галіны (рэкамендацыя)")
    (overview-card-resolve-conflict . "Вырашыць канфлікт (тут)")
    (overview-card-push-pull . "Парады Push/Pull")
    (overview-card-branches . "Агляд галінаў")
    (overview-card-restore-file . "Аднавіць файл (інструкцыя)")
    (overview-card-reset-files . "Скінуць файлы (інструкцыя)")
    (overview-no-data . "(няма даных — націсніце [. g] для абнаўлення)")
    (overview-stale . "(стан змяніўся — націсніце [. g] для абнаўлення)")
    (patch-opened . "Адказ адкрыты ў буферы патча")))

(defun magpt--i18n (key &rest args)
  "Format localized message for KEY with ARGS using `magpt-info-language'."
  (when (fboundp 'magpt--maybe-load-rc)
    (magpt--maybe-load-rc))
  (let* ((lang (magpt--lang-code))
         (tbl (pcase lang
                ('ru magpt--i18n-ru)
                ('fr magpt--i18n-fr)
                ('zh magpt--i18n-zh)
                ('uk magpt--i18n-uk)
                ('be magpt--i18n-be)
                (_   magpt--i18n-en)))
         (fmt (or (alist-get key tbl) (alist-get key magpt--i18n-en) "")))
    (when (fboundp 'magpt--log)
      (magpt--log "i18n: key=%S lang=%S fmt=%s" key lang fmt))
    (if args (apply #'format fmt args) fmt)))

(provide 'magpt-i18n)

;;; magpt-i18n.el ends here
